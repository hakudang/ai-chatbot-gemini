# ユースケース仕様書（Use Case Specification）  

AI チャットボット（Google Gemini API）

```text
Version : 1.0
Status  : Frozen
Date    : 2026/01/29
Owner   : BrSE Dang
Input   : System Requirements v1.1
```

---

## 1. 本書の目的
本ユースケース仕様書は、AI チャットボットシステムについて、ユーザー視点での利用シナリオ（Use Case）を詳細に定義し、  
設計・開発・テストの基準資料とすることを目的とする。

---

## 2. アクター（Actors）

| Actor | 説明 |
|------|------|
| End User | チャットボットを利用して質問・対話を行う Web サイト利用者 |
| AI（Gemini） | 問い合わせ内容を解析し、回答を生成する AI システム |
| System（Web System） | チャットボットを埋め込む Web サイト |

---

## 3. ユースケース一覧

| UC-ID | Use Case 名 |
|------|-------------|
| UC-01 | チャットボットを開く／閉じる |
| UC-02 | ウェルカムメッセージを受信する |
| UC-03 | テキスト質問を送信する |
| UC-04 | 画像付き質問を送信する（Vision） |
| UC-05 | 質問入力時に絵文字を使用する |
| UC-06 | 「thinking」状態を表示する |
| UC-07 | チャット履歴を保存・復元する |
| UC-08 | AI 呼び出し時のエラーを処理する |
| UC-09 | 画像アップロード制限を行う |
| UC-10 | 言語を自動判定する |

---

## 4. ユースケース詳細

### UC-01：チャットボットを開く／閉じる
**主アクター**：End User  

**事前条件**
- Web サイトが読み込まれている。
- チャットボットウィジェットが利用可能である。

**事後条件**
- チャットボットのポップアップが表示または非表示となる。

**基本フロー**
1. ユーザーがチャットボットのトグルボタンをクリックする。
2. システムがチャットボットのポップアップを表示する。
3. ユーザーが再度トグルボタン、またはクローズボタンをクリックする。
4. システムがポップアップを閉じる。

**Trace**：SR-01, SR-02

---

### UC-02：ウェルカムメッセージを受信する
**主アクター**：End User  

**事前条件**
- チャットボットが初めて開かれる。

**事後条件**
- ウェルカムメッセージが表示される。

**基本フロー**
1. ユーザーがチャットボットを開く。
2. システムがチャット履歴の有無を確認する。
3. 履歴が存在しない場合、ウェルカムメッセージを表示する。

**Trace**：SR-03

---

### UC-03：テキスト質問を送信する
**主アクター**：End User  
**副アクター**：AI（Gemini）  

**事前条件**
- チャットボットが開いている。
- ユーザーがテキストを入力している。

**事後条件**
- AI がテキストで回答する。

**基本フロー**
1. ユーザーが質問文を入力する。
2. ユーザーが送信操作（Enter キーまたは送信ボタン）を行う。
3. システムが user-message を表示する。
4. システムが Gemini API にリクエストを送信する。
5. AI がレスポンスを返す。
6. システムが bot-message を表示する。

**例外**
- 入力が空の場合：送信しない。
- API エラー発生時：UC-08 に遷移する。

**Trace**：SR-04, SR-05, SR-06

---

### UC-04：画像付き質問を送信する（Vision）
**主アクター**：End User  
**副アクター**：AI（Gemini）  

**事前条件**
- チャットボットが開いている。
- 有効な画像が選択されている。

**事後条件**
- AI が画像内容を考慮して回答する。

**基本フロー**
1. ユーザーが画像を選択する。
2. システムが画像プレビューを表示する。
3. ユーザーが質問文を入力する（任意）。
4. ユーザーが送信する。
5. システムが画像を Base64 エンコードし、プロンプトとともに送信する。
6. AI がレスポンスを返す。
7. システムが bot-message を表示する。

**Trace**：SR-07, SR-08

---

### UC-05：質問入力時に絵文字を使用する
**主アクター**：End User  

**基本フロー**
1. ユーザーが絵文字ピッカーを開く。
2. 絵文字を選択する。
3. 選択した絵文字が textarea のカーソル位置に挿入される。

**Trace**：SR-09

---

### UC-06：「thinking」状態を表示する
**主アクター**：End User  

**基本フロー**
1. システムが AI へリクエストを送信する。
2. システムが「thinking」インジケーターを表示する。
3. レスポンスまたはエラー発生時にインジケーターを非表示にする。

**Trace**：SR-10

---

### UC-07：チャット履歴を保存・復元する
**主アクター**：End User  

**基本フロー**
1. システムが chatHistory を localStorage に保存する。
2. ユーザーがページを再読み込みする。
3. システムが履歴を読み込み、チャット画面に再表示する。

**Trace**：SR-12

---

### UC-08：AI 呼び出し時のエラーを処理する
**主アクター**：End User  

**基本フロー**
1. API またはネットワークエラーが発生する。
2. システムがエラーメッセージを表示する。
3. ユーザーはチャットを継続できる。

**Trace**：SR-11

---

### UC-09：画像アップロード制限を行う
**主アクター**：End User  

**基本フロー**
1. ユーザーが画像を選択する。
2. システムがサイズおよび形式を検証する。
3. 不正な場合、エラーメッセージを表示する。

**Trace**：SR-13

---

### UC-10：言語を自動判定する
**主アクター**：End User  
**副アクター**：AI（Gemini）  

**基本フロー**
1. ユーザーが質問を送信する。
2. AI が入力言語を自動判定する。
3. ボットが同一言語で回答する。

**Trace**：SR-14

---

## 5. トレーサビリティマトリクス

| System Requirement | Use Case |
|-------------------|----------|
| SR-01, SR-02 | UC-01 |
| SR-03 | UC-02 |
| SR-04, SR-05, SR-06 | UC-03 |
| SR-07, SR-08 | UC-04 |
| SR-09 | UC-05 |
| SR-10 | UC-06 |
| SR-12 | UC-07 |
| SR-11 | UC-08 |
| SR-13 | UC-09 |
| SR-14 | UC-10 |

---

## 6. 改訂履歴

| Version | Date | Description | Author |
|-------|------|-------------|--------|
| 1.0 | 2026/01/29 | 初版作成 | BrSE Dang |
